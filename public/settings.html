<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
        <title>Weddrapp.com</title>
        <link rel="shortcut icon" href="../image/ic_title.png" />

        <!-- Bootstrap -->
        <link href="assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet">
        <!--side menu plugin-->
        <link href="assets/plugins/hoe-nav/hoe.css" rel="stylesheet">
        <!-- icons-->
        <link href="assets/plugins/ionicons/css/ionicons.min.css" rel="stylesheet">
        <link href="assets/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet">
        <link href="assets/plugins/lightbox2/dist/css/lightbox.css" rel="stylesheet">
        <!--template custom css file-->
        <link href="assets/css/style.css" rel="stylesheet">

        <script src="assets/js/modernizr.js"></script>
        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
    </head>
    <body hoe-navigation-type="vertical" hoe-nav-placement="left" theme-layout="wide-layout">

        <!--side navigation start-->
        <div id="hoeapp-wrapper" class="hoe-hide-lpanel" hoe-device-type="desktop">
          <header id="hoe-header" hoe-lpanel-effect="shrink">
              <div class="hoe-left-header">
                  <a href="#"> <span>Weddr</span></a>
                  <span class="hoe-sidebar-toggle"><a href="#"></a></span>
              </div>

              <div class="hoe-right-header" hoe-position-type="relative">
                  <span class="hoe-sidebar-toggle"><a href="#"></a></span>
                  <ul class="left-navbar">
                      <li>
                          <div class="top-search hidden-xs">
                              <form>
                                  <input type="text" class="form-control" placeholder="Search here">
                                  <i class="ion-search"></i>
                              </form>
                          </div>
                      </li>

                  </ul>
                  <ul class="right-navbar navbar-right">
                      <li class="dropdown">
                          <a href="#" data-toggle="dropdown" class="dropdown-toggle"><img src="assets/images/uk.png" alt="">United Kingdom</a>
                      </li>
                      <li class="dropdown">
                          <a href="#" data-toggle="dropdown" class="dropdown-toggle"><img id = "nav_userphoto" src="assets/images/avtar.png" alt="" width="30" height = "30" class="img-circle"><label id="nav_username">Emily Doe</label></a>
                          <ul class="dropdown-menu dropdown-menu-scale user-dropdown">
                              <li><a href="profile.html"><i class="ion-person"></i> Profile </a></li>
                              <li><a href="settings.html"><i class="ion-settings"></i> Settings </a></li>
                              <li><a href="../../views/index.html"><i class="ion-log-out"></i> Logout </a></li>
                          </ul>
                      </li>
                  </ul>
              </div>
          </header>
            <div id="hoeapp-container" hoe-color-type="lpanel-bg7" hoe-lpanel-effect="shrink">
              <aside id="hoe-left-panel" hoe-position-type="absolute">

                  <ul class="nav panel-list">

                      <li class="active">
                          <a href="dashboard.html">
                              <i class="fa fa-home"></i>
                              <span class="menu-text">Dashboard</span>
                              <span class="selected"></span>
                          </a>
                      </li>

                      <li class="hoe-has-menu">
                          <a href="javascript:void(0)">
                              <i class="fa fa-user"></i>
                              <span class="menu-text">User Profile</span>
                              <span class="selected"></span>
                          </a>
                          <ul class="hoe-sub-menu">
                              <li>
                                  <a href="profile.html">
                                      <span class="menu-text">Profile</span>
                                      <span class="selected"></span>
                                  </a>
                              </li>
                              <li>
                                  <a href="settings.html">
                                      <span class="menu-text">Settings</span>
                                      <span class="selected"></span>
                                  </a>
                              </li>
                          </ul>
                      </li>
                  </ul>
              </aside><!--aside left menu end-->



                <!--start main content-->
                <section id="main-content">
                    <div class="space-30"></div>
                    <div class="container">
                      <form class="form-horizontal">
                          <hr>
                          <div class="form-group">
                              <label for="name" class="col-sm-3 control-label">Full Name</label>
                              <div class="col-sm-7">
                                  <input type="email" class="form-control" id="pfullname" placeholder="Emily Doe">
                              </div>
                          </div>
                          <div class="form-group">
                              <label for="pname" class="col-sm-3 control-label">Username</label>
                              <div class="col-sm-7">
                                  <input type="text" class="form-control" id="pusername" placeholder="Emi.Me">
                              </div>
                          </div>
                          <div class="form-group">
                              <label for="pname" class="col-sm-3 control-label">E-Mail</label>
                              <div class="col-sm-7">
                                  <input type="text" class="form-control" id="pemail" placeholder="test@test.com">
                              </div>
                          </div>
                          <div class="form-group">
                              <label for="pname" class="col-sm-3 control-label">Phone</label>
                              <div class="col-sm-7">
                                  <input type="text" class="form-control" id="pphone" placeholder="+4468521356">
                              </div>
                          </div>
                          <div class="form-group">
                              <label for="position" class="col-sm-3 control-label">Position</label>
                              <div class="col-sm-7">
                                  <input type="text" class="form-control" id="pposition" placeholder="Front end developer">
                              </div>
                          </div>

                            <div class="form-group">
                              <label for="address" class="col-sm-3 control-label">Address</label>
                              <div class="col-sm-7">
                                  <input type="text" class="form-control" id="paddress" placeholder="124,Lorem Street, Florida, USA">
                              </div>
                          </div>
                          <!-- <div class="form-group">
                              <label for="pname" class="col-sm-3 control-label">Current password</label>
                              <div class="col-sm-7">
                                  <input type="password" class="form-control" id="pcur_password" placeholder="Current password">
                              </div>
                          </div>
                          <div class="form-group">
                              <label for="pname" class="col-sm-3 control-label">New password</label>
                              <div class="col-sm-7">
                                  <input type="password" class="form-control" id="pnew_password" placeholder="New password">
                              </div>
                          </div> -->
                             <!-- <div class="form-group">
                              <label for="city" class="col-sm-3 control-label">City</label>
                              <div class="col-sm-7">
                                  <input type="text" class="form-control" id="city" placeholder="Florida">
                              </div>
                          </div> -->

                          <hr>
                            <div class="form-group">

                              <label for="skills" class="col-sm-3 control-label">Avatar</label>
                              <div class="col-sm-7">
                                   <img id = "choose_File" src="assets/images/avtar-1.jpg" alt="" width="120" height="120">
                                   <div class="space-20"></div>
                                   <div style="height : 0px; overflow : hidden;">
                                       <input type="file" class="form-control" id="avtar">
                                   </div>
                                   <p class="help-block">JPEG/PNG 120x120px</p>
                              </div>
                          </div>
                          <div class="form-group">
                              <div class="col-sm-offset-3 col-sm-9">
                                  <button type="button" id = "update" class="btn btn-lg btn-primary rounded">Save changes</button>
                                  <button type="button" id = "cancel" class="btn btn-lg btn-warning rounded">Cancel</button>
                              </div>
                          </div>
                      </form>
                    </div>

                    <!--footer start-->
                    <div class="footer">
                        <div class="row">
                            <div class="col-sm-12">
                                <span>&copy; Copyright 2017. Weddr</span>
                            </div>
                        </div>
                    </div>
                    <!--footer end-->
                </section><!--end main content-->
            </div>
        </div><!--end wrapper-->



        <!--Common plugins-->
        <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&key=AIzaSyCTRNmVC4jYWnolYez_25mFtcnSi8L2nuI&signed_in=true&libraries=places"></script>
        <script src="assets/plugins/jquery/dist/jquery.min.js"></script>
        <script src="assets/plugins/bootstrap/js/bootstrap.min.js"></script>
        <script src="assets/plugins/hoe-nav/hoe.js"></script>
        <script src="assets/plugins/pace/pace.min.js"></script>
        <script src="assets/plugins/slimscroll/jquery.slimscroll.min.js"></script>
        <script src="assets/js/app.js"></script>
        <!--page script-->
        <script src="assets/plugins/lightbox2/dist/js/lightbox.min.js"></script>

        <script>
              $(document).ready(function(){
                  var fileupload;
                  var formData =  new FormData();
                  var userdata;
                  var isfileadded = false;
                  function readURL(input){
                    if (input.files && input.files[0]) {
                      var reader = new FileReader();
                      reader.onload = function(e){
                        $('#choose_File').attr('src',e.target.result);
                      }
                      fileupload = input.files[0];
                      reader.readAsDataURL(input.files[0]);
                    }
                  }
                  $('#avtar').change(function (){
                      readURL(this);
                  });

                  $('#choose_File').on('click',function(){
                    $('#avtar').click();
                  });
                  google.maps.event.addDomListener(window, 'load', initialize);
                  function initialize() {
                    var autocomplete = new google.maps.places.Autocomplete(document.getElementById('address'));
                    google.maps.event.addListener(autocomplete, 'place_changed', function () {
                        var place = autocomplete.getPlace();
                    });
                  }


                  getAnUser();
                  function getAnUser()
                  {
                    $.get('/getanuser',function(result){
                        if (result.status == "error") {
                            alert('Can not connect database.');
                        }else if(result.status == "not exist"){
                            alert('Please login again');
                        }else{
                            console.log(result);
                            userdata = result.data;
                            // name.innerHtml = result.data.name;
                            $('#nav_username').text(result.data.name);
                            $('#nav_userphoto').attr('src',result.data.photo);
                            $('#pfullname').val(result.data.fullname);
                            $('#pusername').val(result.data.name);
                            $('#pemail').val(result.data.email);
                            $('#pphone').val(result.data.phone);
                            $('#pposition').val(result.data.position);
                            $('#paddress').val(result.data.address);
                            $('#choose_File').attr('src',result.data.photo);
                        }
                    });
                  }

                  $('#update').on('click',function(){
                      var fullname = $('#pfullname').val();
                      var name = $('#pusername').val();
                      var email = $('#pemail').val();
                      var phone = $('#pphone').val();
                      var address = $("#paddress").val();
                      var position = $('#pposition').val();
                      var photo = userdata.photo;
                      if (fileupload != null) {
                        formData.append('userid',userdata._id);
                        formData.append('fullname',fullname);
                        formData.append('name',name);
                        formData.append('email',email);
                        formData.append('phone',phone);
                        formData.append('userphoto',fileupload);
                        formData.append('phone',phone);
                        formData.append('address',address);
                        $.ajax({
                            url: '/updateuserwithfile',
                            data: formData,
                            type: 'POST',
                            contentType: false, // NEEDED, DON'T OMIT THIS (requires jQuery 1.6+)
                            processData: false, // NEEDED, DON'T OMIT THIS
                            success: function(msg){
                                    location.href = "./profile.html"
                            },
                            error: function(error)
                            {
                                  alert('Failed');
                            }
                        });
                      }else{
                        $.post('/updateuser',{
                          userid : userdata._id,
                          name : name,
                          email : email,
                          phone : phone,
                          address :address,
                          fullname : fullname,
                          position :position,
                          photo : photo
                        },function(result){
                           if (result.status == "success"){
                              location.href = "./profile.html"
                           }else{
                             alert('Failed');
                           }
                        });
                      }

                  });

                  $('#cancel').on('click',function(){
                      location.href = "./profile.html";
                  });
              });
        </script>
    </body>
</html>
